chrome.runtime.onMessage.addListener(((e,o,t)=>{if("calculateImpact"===e.action){console.log("Background script received 'calculateImpact' request:",JSON.stringify(e,null,2));const o={model:"gpt-4o",tokens:e.tokens};return console.log("Sending request to backend:",JSON.stringify(o,null,2)),fetch("https://chattometer.onrender.com/calculate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)}).then((e=>e.ok?e.json():e.text().then((o=>{throw console.error(`Backend responded with error: ${e.status}`,o),new Error(`Backend Error: ${e.status} - ${o}`)})))).then((e=>{console.log("Received successful data from backend:",JSON.stringify(e,null,2)),console.log("Sending success response to content script."),t({success:!0,data:e})})).catch((e=>{console.error("Error during fetch or processing in background:",e),console.log("Sending error response to content script."),t({success:!1,error:e.message})})),!0}})),console.log("Chattometer background script loaded"),chrome.webNavigation.onHistoryStateUpdated.addListener((e=>{chrome.tabs.sendMessage(e.tabId,{action:"reinitializeChattometer"},(()=>{chrome.runtime.lastError&&console.warn("Error sending reinit message to content script:",chrome.runtime.lastError.message)}))}));