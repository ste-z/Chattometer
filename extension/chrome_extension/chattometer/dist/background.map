{"version":3,"file":"background.js","mappings":";;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","sources":["webpack://chattometer/./src/scripts/background.js"],"sourcesContent":["// Listen for messages from the content script\nchrome.runtime.onMessage.addListener((request, sender, sendResponse) => {\n  if (request.action === \"calculateImpact\") {\n    // --- Log request received ---\n    console.log(\"Background script received 'calculateImpact' request:\", JSON.stringify(request, null, 2));\n\n    const requestBody = {\n        // FIXME: use different model names based on request.modelName if needed\n        model: \"gpt-4o\",\n        tokens: request.tokens\n    };\n\n    // --- Log request body being sent to backend ---\n    console.log(\"Sending request to backend:\", JSON.stringify(requestBody, null, 2));\n\n\n    // Perform the fetch request\n    // FIXME: the current endpoint is a local Flask server running on port 5000, use actual endpoint in production\n    fetch('https://chattometer.onrender.com/calculate', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n      },\n      body: JSON.stringify(requestBody),\n    })\n    .then(response => {\n      if (!response.ok) {\n        // If response is not ok, create an error object to send back\n        return response.text().then(text => {\n          // --- Log backend error response ---\n          console.error(`Backend responded with error: ${response.status}`, text);\n          throw new Error(`Backend Error: ${response.status} - ${text}`); // More informative error\n        });\n      }\n      return response.json(); // Parse JSON if response is ok\n    })\n    .then(data => {\n      // --- Log successful data from backend ---\n      console.log(\"Received successful data from backend:\", JSON.stringify(data, null, 2));\n      // Send the successful data back to the content script\n      console.log(\"Sending success response to content script.\");\n      sendResponse({ success: true, data: data });\n    })\n    .catch(error => {\n      // --- Log fetch/processing error ---\n      console.error('Error during fetch or processing in background:', error);\n      // Send an error object back to the content script\n      console.log(\"Sending error response to content script.\");\n      sendResponse({ success: false, error: error.message });\n    });\n\n    // Return true to indicate that the response will be sent asynchronously\n    return true;\n  }\n});\n\nconsole.log(\"Chattometer background script loaded\");\n\n// Listen for SPA navigation events and notify content scripts to reinitialize\nchrome.webNavigation.onHistoryStateUpdated.addListener((details) => {\n  chrome.tabs.sendMessage(details.tabId, { action: 'reinitializeChattometer' }, () => {\n    if (chrome.runtime.lastError) {\n      console.warn('Error sending reinit message to content script:', chrome.runtime.lastError.message);\n    }\n  });\n});\n"],"names":[],"sourceRoot":""}